function exibirMensagem(n){$("#modalMessageText")[0].textContent=n;$("#showModalMessage").click()}function successConsultaDatabase(n){$("#selDatabases > option").remove();fillDropDown("#selDatabases",n);consultarSchemas()}function successConsultaSchema(n){$("#selSchemas > option").remove();fillDropDown("#selSchemas",n);consultarTabelas()}function successConsultaTabela(n){$("#selTabelas > option").remove();fillDropDown("#selTabelas",n);consultarColunas()}function successConsultarColunas(n){n.length>0&&$("#divColunas").attr("hidden",!1);$("#tblColunas > tbody tr").remove();$.each(n,function(n,t){let i=t.podeOcultar?"":" disabled ";$("#tblColunas > tbody").append("<tr><td>"+t.name+'<\/td><td class="text-center"><input type="checkbox" '+i+(t.visivel?'checked="checked" ':"")+'/><\/td><td class="text-center"><input type="checkbox" '+(t.filtro?'checked="checked" ':"")+"/><\/td><\/tr>")});consultarColunasChaveEstrangeira()}function successConsultaChavesEstrangeiras(n){n.length>0&&$("#divFk").attr("hidden",!1);$("#tblChavesEstrangeiras > tbody tr").remove();$.each(n,function(n,t){let i="";$.each(t.colunasTabelaReferenciada,(n,t)=>{i+='<option value="'+t+'">'+t+"<\/option>"});$("#tblChavesEstrangeiras > tbody").append("<tr><td>"+t.nome+"<\/td><td>"+t.tabelaReferenciada+"."+t.colunaReferenciada+'<\/td><td><select class="custom-select" id="select-'+n+'">'+i+"<\/select><\/tr>");$("#select-"+n)[0].selectedIndex=t.indiceColTabelaReferenciada});awaitLoad(!1)}function consultarDatabases(){bloquearTela();$.ajax({method:"GET",dataType:"JSON",url:"/Configuracao/SelecionarDatabases",success:function(n){successConsultaDatabase(n)},error:function(){desbloquearTela();exibirMensagem("Houve um erro ao consultar as databases.")}})}function consultarSchemas(){$.ajax({method:"GET",dataType:"JSON",url:"/Configuracao/SelecionarSchemas?database="+$("#selDatabases")[0].value,success:function(n){successConsultaSchema(n)},error:function(){desbloquearTela();exibirMensagem("Houve um erro ao consultar os schemas.")}})}function consultarTabelas(){$.ajax({method:"GET",dataType:"JSON",url:"/Configuracao/SelecionarTabelas?database="+$("#selDatabases")[0].value+"&schema="+$("#selSchemas")[0].value,success:function(n){successConsultaTabela(n)},error:function(){desbloquearTela();exibirMensagem("Houve um erro ao consultar as tabelas.")}})}function consultarColunas(){$("#selTabelas")[0].value!==""?$.ajax({method:"GET",dataType:"JSON",url:"/Configuracao/SelecionarColunas?database="+$("#selDatabases")[0].value+"&schema="+$("#selSchemas")[0].value+"&tabela="+$("#selTabelas")[0].value,success:function(n){successConsultarColunas(n)},error:function(){desbloquearTela();exibirMensagem("Houve um erro ao consultar as colunas.")},complete:()=>{awaitLoad(!1)},beforeSend:()=>{bloquearTela(),awaitLoad(!0)}}):(desbloquearTela(),$("#divColunas").attr("hidden",!0),$("#tblColunas > tbody tr").remove())}function consultarColunasChaveEstrangeira(){$("#selTabelas")[0].value!==""?$.ajax({method:"GET",dataType:"JSON",url:"/Configuracao/SelecionarColunasChaveEstrangeira?database="+$("#selDatabases")[0].value+"&schema="+$("#selSchemas")[0].value+"&tabela="+$("#selTabelas")[0].value,error:function(){$("#divFk").attr("hidden",!0);exibirMensagem("Houve um erro ao consultar as colunas de chave estrangeira.")},complete:()=>{desbloquearTela(),awaitLoad(!1)},success:function(n){successConsultaChavesEstrangeiras(n)},beforeSend:()=>{$("#divFk").attr("hidden",!0),awaitLoad(!0)}}):($("#divFk").attr("hidden",!0),$("#tblChavesEstrangeiras > tbody tr").remove())}function awaitLoad(n){$("#selDatabases")[0].disabled=n;$("#selSchemas")[0].disabled=n;$("#selTabelas")[0].disabled=n}function fillDropDown(n,t){t.length>0&&$.each(t,function(t,i){$(n).append('<option value="'+i.name+'">'+i.name+"<\/option>")})}function bloquearTela(){document.getElementById("modalLoading").style.display="block"}function desbloquearTela(){document.getElementById("modalLoading").style.display="none"}function gravar(){let n="",i=$("#selDatabases")[0].value+";"+$("#selSchemas")[0].value+";"+$("#selTabelas")[0].value+"|",t=$("#tblColunas tbody > tr");if($.each(t,(t,i)=>{i.getElementsByTagName("input")[0].checked&&(n+=i.innerHTML.replace(/<\/td>/g,"").replace('<td class="text-center">',"<td>").split("<td>")[1]+";")}),n!==""&&(n=i+n,n=n.substr(0,n.length-1)),n===undefined||n===null||n==="")exibirMensagem("Selecione ao menos uma coluna que deseja exibir!");else{let i="";t=$("#tblChavesEstrangeiras tbody > tr");$.each(t,(n,t)=>{let r=t.getElementsByTagName("select")[0].value;i+=t.innerHTML.replace(/<\/td>/g,"").split("<td>")[1]+":"+r+";"});i!==""&&(i=i.substr(0,i.length-1));let r="";t=$("#tblColunas tbody > tr");$.each(t,(n,t)=>{t.getElementsByTagName("input")[1].checked&&(r+=t.innerHTML.replace(/<\/td>/g,"").replace('<td class="text-center">',"<td>").split("<td>")[1]+";")});r!==""&&(r=r.substr(0,r.length-1));$.ajax({method:"post",contentType:"application/x-www-form-urlencoded",data:{dados:n,dadosfk:i,dadosfiltro:r},dataType:"json",url:"/Configuracao/GravarConfiguracoesTabela",success:function(n){n.result?exibirMensagem("Configurações salvas com sucesso!"):exibirMensagem("Erro ao salvar as configurações: "+n.message)},error:function(n){exibirMensagem("Erro ao salvar as configurações: "+n.message)}})}}function cadDinamico(){let n=document.getElementById("selDatabases").value,t=document.getElementById("selSchemas").value,i=document.getElementById("selTabelas").value;window.location.href=`/CadDinamico/Index?database=${n}&schema=${t}&tabela=${i}`}$(document).ready(()=>{$("#divColunas").attr("hidden",!0),$("#divFk").attr("hidden",!0),consultarDatabases(),$("#selDatabases").change(()=>{$("#divFk").attr("hidden",!0),$("#divColunas").attr("hidden",!0),$("#tblChavesEstrangeiras > tbody tr").remove(),$("#tblColunas > tbody tr").remove(),$("#selSchemas > option").remove(),consultarSchemas()}),$("#selSchemas").change(()=>{$("#divFk").attr("hidden",!0),$("#divColunas").attr("hidden",!0),$("#tblChavesEstrangeiras > tbody tr").remove(),$("#tblColunas > tbody tr").remove(),$("#selTabelas > option").remove(),consultarTabelas()}),$("#selTabelas").change(()=>{$("#divFk").attr("hidden",!0),$("#divColunas").attr("hidden",!0),$("#tblChavesEstrangeiras > tbody tr").remove(),$("#tblColunas > tbody tr").remove(),consultarColunas()})});